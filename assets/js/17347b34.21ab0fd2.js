"use strict";(self.webpackChunkstylable_io=self.webpackChunkstylable_io||[]).push([[6468],{720:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"getting-started/nextjs-integration","title":"NextJS","description":"There are a few steps you need to follow to integrate Stylable into your NextJS project.","source":"@site/docs/getting-started/nextjs-integration.md","sourceDirName":"getting-started","slug":"/getting-started/nextjs-integration","permalink":"/docs/getting-started/nextjs-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/wixplosives/stylable.io/edit/master/docs/getting-started/nextjs-integration.md","tags":[],"version":"current","frontMatter":{"id":"nextjs-integration","title":"NextJS"},"sidebar":"Discover","previous":{"title":"Integrations","permalink":"/docs/getting-started/integrations"},"next":{"title":"Rollup","permalink":"/docs/getting-started/rollup-integration"}}');var l=t(4848),s=t(8453);const r={id:"nextjs-integration",title:"NextJS"},a=void 0,o={},c=[{value:"Example Configuration:",id:"example-configuration",level:4},{value:"Using 3rd-party stylesheets",id:"using-3rd-party-stylesheets",level:3},{value:"Example Configuration:",id:"example-configuration-1",level:4},{value:"TypeScript integration",id:"typescript-integration",level:3},{value:"App directory",id:"app-directory",level:3},{value:"Example Configuration:",id:"example-configuration-2",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"There are a few steps you need to follow to integrate Stylable into your NextJS project."}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Install ",(0,l.jsx)(n.code,{children:"@stylable/webpack-plugin"})," as a ",(0,l.jsx)(n.code,{children:"devDependency"})," in your ",(0,l.jsx)(n.code,{children:"package.json"})," file."]}),"\n",(0,l.jsxs)(n.li,{children:["Create a ",(0,l.jsx)(n.code,{children:"next.config.js"})," file."]}),"\n",(0,l.jsx)(n.li,{children:"Exclude other CSS loaders from loading Stylable (*.st.css) files."}),"\n",(0,l.jsx)(n.li,{children:"Add the Stylable plugin to the webpack configuration."}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"example-configuration",children:"Example Configuration:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",metastring:'title="next.config.js"',children:"const { \n  StylableWebpackPlugin,\n  applyWebpackConfigStylableExcludes \n} = require('@stylable/webpack-plugin');\n\n/* \n * single optimizer for NextJS multiple builds \n * in order to sync client/server namespaces \n*/\nconst StylableOptimizer = require('@stylable/optimizer').StylableOptimizer;\nconst stylableOptimizer = new StylableOptimizer();\n\nmodule.exports = {\n  webpack: (config) => {\n    /* exclude Stylable files from all other loaders */\n    applyWebpackConfigStylableExcludes(config);\n\n    /* add the Stylable plugin to the webpack configuration */\n    config.plugins.push(\n      new StylableWebpackPlugin({\n        /* let NextJS handle assets */\n        filterAssets: () => false,\n\n        /* output CSS to the correct location */\n        filename: 'static/css/stylable.[contenthash].css',\n\n        /* a shared optimizer instance */\n        optimizer: stylableOptimizer,\n      })\n    );\n    return config;\n  },\n};\n"})}),"\n",(0,l.jsx)(n.admonition,{type:"important",children:(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"applyWebpackConfigStylableExcludes"})," export and ",(0,l.jsx)(n.code,{children:"filterAssets"})," flag are available in ",(0,l.jsx)(n.code,{children:"@stylable/webpack-plugin"})," version ",(0,l.jsx)(n.code,{children:"4.2.2"})," and onwards."]})}),"\n",(0,l.jsx)(n.h3,{id:"using-3rd-party-stylesheets",children:"Using 3rd-party stylesheets"}),"\n",(0,l.jsxs)(n.p,{children:["If your project consumes any 3rd-party Stylable stylesheets, additional configuration is required to ensure that they will be handled by ",(0,l.jsx)(n.code,{children:"@stylable/webpack-plugin"}),":"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Add an import to ",(0,l.jsx)(n.code,{children:"bundleServerLibs"})," from ",(0,l.jsx)(n.code,{children:"@stylable/webpack-plugin"})]}),"\n",(0,l.jsxs)(n.li,{children:["Use the ",(0,l.jsx)(n.code,{children:"isServer"})," flag from the webpack configuration context in the second argument"]}),"\n",(0,l.jsxs)(n.li,{children:["Call ",(0,l.jsx)(n.code,{children:"bundleServerLibs"})," with the webpack ",(0,l.jsx)(n.code,{children:"config"}),", packages to bundle, and the ",(0,l.jsx)(n.code,{children:"isServer"})," flag"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"example-configuration-1",children:"Example Configuration:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",metastring:'title="next.config.js"',children:"const { \n  StylableWebpackPlugin,\n  applyWebpackConfigStylableExcludes,\n  bundleServerLibs\n} = require('@stylable/webpack-plugin');\n\n/* \n * single optimizer for NextJS multiple builds \n * in order to sync client/server namespaces \n*/\nconst StylableOptimizer = require('@stylable/optimizer').StylableOptimizer;\nconst stylableOptimizer = new StylableOptimizer();\n\nmodule.exports = {\n  webpack: (config, { isServer }) => {\n    /* exclude Stylable files from all other loaders */\n    applyWebpackConfigStylableExcludes(config);\n    \n    /* causes provided packages to be bundled (not external) */\n    bundleServerLibs(config, new Set(['PACKAGE1', 'PACKAGE2'], isServer));\n\n    /* add the Stylable plugin to the webpack configuration */\n    config.plugins.push(\n      new StylableWebpackPlugin({\n        /* let NextJS handle assets */\n        filterAssets: () => false,\n\n        /* output CSS to the correct location */\n        filename: 'static/css/stylable.[contenthash].css',\n\n        /* a shared optimizer instance */\n        optimizer: stylableOptimizer,\n      })\n    );\n    return config;\n  },\n};\n"})}),"\n",(0,l.jsx)(n.h3,{id:"typescript-integration",children:"TypeScript integration"}),"\n",(0,l.jsxs)(n.p,{children:["If your NextJS project is configured to work with TypeScript, see our page on ",(0,l.jsx)(n.a,{href:"/docs/getting-started/typescript-integration",children:"integrating Stylable with TypeScript"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"app-directory",children:"App directory"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["Support for Next.js ",(0,l.jsx)(n.a,{href:"https://beta.nextjs.org/docs/app-directory-roadmap",children:"App directory"})," is experimental."]})}),"\n",(0,l.jsx)(n.p,{children:"There are two settings that are required to integrate Stylable with the App directory mode:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["set ",(0,l.jsx)(n.code,{children:"cssInjection:css"})," in order to force CSS to be served as a static CSS file in dev mode. This is required because App directory mode defaults to React server render, and Stylable defaults to injecting CSS via Javascript in development which doesn't reach the browser."]}),"\n",(0,l.jsxs)(n.li,{children:["set ",(0,l.jsx)(n.code,{children:"experimentalAttachCssToContainingChunks:true"})," to change the way the generated CSS asset is attached to Webpack chunks in order for Next.js to pick it up as a CSS module and not a JavaScript module."]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"example-configuration-2",children:"Example Configuration:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",metastring:'title="next.config.js"',children:"const { \n  StylableWebpackPlugin,\n  applyWebpackConfigStylableExcludes \n} = require('@stylable/webpack-plugin');\n\n/* \n * single optimizer for NextJS multiple builds \n * in order to sync client/server namespaces \n*/\nconst StylableOptimizer = require('@stylable/optimizer').StylableOptimizer;\nconst stylableOptimizer = new StylableOptimizer();\n\nmodule.exports = {\n  webpack: (config) => {\n    /* exclude Stylable files from all other loaders */\n    applyWebpackConfigStylableExcludes(config);\n\n    /* add the Stylable plugin to the webpack configuration */\n    config.plugins.push(\n      new StylableWebpackPlugin({\n        /* let NextJS handle assets */\n        filterAssets: () => false,\n\n        /* output CSS to the correct location */\n        filename: 'static/css/stylable.[contenthash].css',\n\n        /* a shared optimizer instance */\n        optimizer: stylableOptimizer,\n\n        /* serve CSS as a bundled asset */\n        cssInjection: 'css',\n\n        /* attach CSS to every chunk containing a Stylable stylesheet,\n           instead of to entry chunks \n        */\n        experimentalAttachCssToContainingChunks: true,\n      })\n    );\n    return config;\n  },\n};\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(6540);const l={},s=i.createContext(l);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);