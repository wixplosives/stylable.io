(self.webpackChunkstylable_io=self.webpackChunkstylable_io||[]).push([[3609],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=p(n),m=i,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||a;return n?r.createElement(g,s(s({ref:t},c),{},{components:n})):r.createElement(g,s({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,s=new Array(a);s[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var p=2;p<a;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9140:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return o},toc:function(){return l},default:function(){return c}});var r=n(2122),i=n(9756),a=(n(7294),n(3905)),s={id:"ssr",title:"Supporting Server Side Rendering",sidebar_label:"Server Side Rendering"},o={unversionedId:"guides/ssr",id:"guides/ssr",isDocsHomePage:!1,title:"Supporting Server Side Rendering",description:"Server side rendering (SSR) is an approach to serving JavaScript rendered web applications (such as React, Vue, Angular, etc...) that tries to improve time-to-paint, SEO support and more.",source:"@site/docs/guides/server-side-rendering.md",sourceDirName:"guides",slug:"/guides/ssr",permalink:"/docs/guides/ssr",editUrl:"https://github.com/wixplosives/stylable.io/edit/master/docs/docs/guides/server-side-rendering.md",version:"current",sidebar_label:"Server Side Rendering",frontMatter:{id:"ssr",title:"Supporting Server Side Rendering",sidebar_label:"Server Side Rendering"},sidebar:"Guides",previous:{title:"Component Variants",permalink:"/docs/guides/component-variants"},next:{title:"Migrating to Stylable v3",permalink:"/docs/guides/migration-v3"}},l=[{value:"Rendering Stylable in the Client",id:"rendering-stylable-in-the-client",children:[]},{value:"Transforming Stylable in the Server",id:"transforming-stylable-in-the-server",children:[]},{value:"Matching namespaces",id:"matching-namespaces",children:[{value:"Supporting multiple transpilation targets",id:"supporting-multiple-transpilation-targets",children:[]},{value:"Publishing SSR-ready source files (<code>*.st.css</code>)",id:"publishing-ssr-ready-source-files-stcss",children:[]}]}],p={toc:l};function c(e){var t=e.components,n=(0,i.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Server side rendering (SSR) is an approach to serving JavaScript rendered web applications (such as React, Vue, Angular, etc...) that tries to improve time-to-paint, SEO support and more."),(0,a.kt)("p",null,"To learn more about SSR - see this ",(0,a.kt)("a",{parentName:"p",href:"https://dev.to/sunnysingh/the-benefits-and-origins-of-server-side-rendering-4doh"},"introduction post"),"."),(0,a.kt)("p",null,"When creating your library / application you will see that you might need to make some changes to your project publish / consumption process in order to integrate Stylable to your SSR flow."),(0,a.kt)("h2",{id:"rendering-stylable-in-the-client"},"Rendering Stylable in the Client"),(0,a.kt)("p",null,"To integrate Stylable into your application, use ",(0,a.kt)("inlineCode",{parentName:"p"},"@stylable/webpack-plugin")," and ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/wix/stylable/tree/master/packages/webpack-plugin"},"configure")," it according to your project needs."),(0,a.kt)("h2",{id:"transforming-stylable-in-the-server"},"Transforming Stylable in the Server"),(0,a.kt)("p",null,"In order to use Stylable imports from your source files in ",(0,a.kt)("inlineCode",{parentName:"p"},"nodeJS"),", you will need to add ",(0,a.kt)("inlineCode",{parentName:"p"},"@stylable/node")," as a dependency."),(0,a.kt)("p",null,"Import and use its ",(0,a.kt)("inlineCode",{parentName:"p"},"requireHook")," method before rendering to enable requiring Stylable stylesheets in their ",(0,a.kt)("inlineCode",{parentName:"p"},"CommonJS")," module format."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// server.js \nconst { attachHook } = require('@stylable/node');\n\nattachHook(); // enables requiring .st.css files as CommonJS\n\n// < render application ... >\n")),(0,a.kt)("h2",{id:"matching-namespaces"},"Matching namespaces"),(0,a.kt)("p",null,"In order to ensure full SSR compatibility, ",(0,a.kt)("strong",{parentName:"p"},"generated namespaces for all stylesheets must match exactly")," across all different build targets."),(0,a.kt)("p",null,"The default Stylable ",(0,a.kt)("inlineCode",{parentName:"p"},"namespaceResolver")," uses a combination of file-system path, name and version from the ",(0,a.kt)("inlineCode",{parentName:"p"},"package.json")," file to create its namespace. This means that namespaces can be influenced by the published file path structure."),(0,a.kt)("p",null,"If you choose to provide an alternative namespace resolver that does not depend on file paths as part of its namespace creation, then you can avoid the problem described below."),(0,a.kt)("h3",{id:"supporting-multiple-transpilation-targets"},"Supporting multiple transpilation targets"),(0,a.kt)("p",null,"When building a library or application for consumption in both client and server environments it is common to output multiple transpilation targets for various module systems."),(0,a.kt)("p",null,"This means that a published project will usually have both ",(0,a.kt)("inlineCode",{parentName:"p"},"CommonJS")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"ES modules"),", each with their own transpiled copy of the project, including the Stylable assets."),(0,a.kt)("p",null,"This can pose a problem when trying to synchronize namespace creation for SSR. "),(0,a.kt)("h3",{id:"publishing-ssr-ready-source-files-stcss"},"Publishing SSR-ready source files (",(0,a.kt)("inlineCode",{parentName:"h3"},"*.st.css"),")"),(0,a.kt)("p",null,"The Stylable CLI offers a feature that allows you to sync your namespace across dist targets by inserting a custom header comment to the start of your ",(0,a.kt)("inlineCode",{parentName:"p"},".st.css")," file. This header comment is used to normalize namespacing paths across different build targets."),(0,a.kt)("p",null,"When using ",(0,a.kt)("inlineCode",{parentName:"p"},"@stylable/cli")," to publish your source stylesheets, use the ",(0,a.kt)("inlineCode",{parentName:"p"},"useNamespaceReference")," flag to mark all targets as originating from the same original source."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"stc --srcDir ./src --outDir ./dist/cjs --cjs --stcss --useNamespaceReference\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"stc --srcDir ./src --outDir ./dist/esm --esm --stcss --useNamespaceReference\n")),(0,a.kt)("p",null,"For this to work properly, your source folder must be published along with your distribution build targets."))}c.isMDXComponent=!0}}]);